#REGTEST_TYPE=devel

# This reg-test tests 8 scenarios with and without tickets, with various
# combinations of settings for allow-0rtt, with TLSv1.2. Each client will try
# to established a connection, then try to reconnect 10 times resuming, and
# check for which combination(s) 0-rtt is used and fail if any does so since
# it's not expected to work with 1.2.

varnishtest "Test if the SSL session/ticket reuse works correctly for TLSv1.2"
feature cmd "$HAPROXY_PROGRAM -cc 'feature(OPENSSL_WOLFSSL) || feature(OPENSSL) && ssllib_name_startswith(OpenSSL) && openssl_version_atleast(1.1.1)'"

setenv VTC_SOCK_TYPE stream
setenv TLSV TLSv1.2
setenv ALPN http/1.1
include ${testdir}/../ssl/ssl-0rtt.vtci
